<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Glosarium</title>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- PapaParse -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<!-- Bootstrap 5 CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- DataTables Bootstrap 5 CSS & JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<style>
  body { font-family: Arial, sans-serif; margin: 20px; background:#fafafa; }
  h1 { text-align:center; margin-bottom: 20px; }

  /* Table Styling */
  #glossaryTable {
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    background: #fff;
  }
  #glossaryTable thead th {
    background: linear-gradient(135deg, #4f93ce, #28527a);
    color: #fff;
    font-weight: bold;
    text-transform: uppercase;
  }
  #glossaryTable tbody tr:nth-child(odd) {
    background-color: #f9f9f9;
  }
  #glossaryTable tbody tr:hover {
    background-color: #e6f0ff;
  }

  /* Search box */
  #searchInput {
    margin-bottom: 15px;
    padding: 8px 12px;
    border: 1px solid #ccc;
    border-radius: 20px;
    transition: 0.3s;
    max-width: 360px;
    width: 100%;
  }
  #searchInput:focus {
    border-color: #4f93ce;
    box-shadow: 0 0 5px rgba(79,147,206,0.5);
    outline: none;
  }

  /* Pagination buttons */
  .dataTables_paginate .paginate_button {
    border-radius: 4px;
    border: 1px solid transparent;
    padding: 5px 10px;
  }
  .dataTables_paginate .paginate_button:hover {
    background: #4f93ce !important;
    color: #fff !important;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>Glosarium</h1>
    <input id="searchInput" type="text" placeholder="Cari istilah atau padanan..." class="form-control" />
    <table id="glossaryTable" class="table table-striped table-bordered display nowrap" style="width:100%">
      <thead>
        <tr>
          <th>Istilah/Frasa (Bahasa Indonesia)</th>
          <th>Padanan Formal (Bahasa Inggris)</th>
          <th>Tanggal Unggah</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
(async function(){
  const sheetCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTIDIKfUwmik4T5jZdnHVtD-9y4e7k68d_qp-aHCw9Y8PwgGWejyz8zzRvS3WHHlzSo9tof69ZJK_lN/pub?output=csv";

  function esc(s){ return s==null? '' : String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  Papa.parse(sheetCSV, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      const rows = results.data;
      const tbody = $("#glossaryTable tbody");
      tbody.empty();

      rows.forEach(r => {
        const term = r['Istilah/Frasa (Bahasa Indonesia)'] ?? r['Istilah'] ?? r['Term'] ?? Object.values(r)[0] ?? '';
        const eng  = r['Padanan Formal dalam Bahasa Inggris'] ?? r['Padanan Formal (Bahasa Inggris)'] ?? r['Padanan'] ?? r['English'] ?? Object.values(r)[1] ?? '';
        let dateRaw = r['Tanggal Unggah'] ?? r['Tanggal'] ?? r['Date'] ?? Object.values(r)[2] ?? '';
        let dateText = dateRaw ? String(dateRaw).trim() : '';
        let timestamp = '';

        if (dateText) {
          let parsed = Date.parse(dateText);
          if (isNaN(parsed)) {
            const parts = dateText.match(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})/);
            if (parts) {
              let d = parts[1].padStart(2,'0'), m = parts[2].padStart(2,'0'), y = parts[3];
              if (y.length === 2) y = '20' + y;
              parsed = Date.parse(`${y}-${m}-${d}`);
              if (!isNaN(parsed)) dateText = `${y}-${m}-${d}`;
            }
          } else {
            const dt = new Date(parsed);
            const y = dt.getFullYear();
            const m = String(dt.getMonth()+1).padStart(2,'0');
            const d = String(dt.getDate()).padStart(2,'0');
            dateText = `${y}-${m}-${d}`;
          }
          if (!isNaN(parsed)) timestamp = parsed;
        }

        const tr = $("<tr>");
        tr.append(`<td>${esc(term)}</td>`);
        tr.append(`<td>${esc(eng)}</td>`);
        if (timestamp) {
          tr.append(`<td data-order="${timestamp}">${esc(dateText)}</td>`);
        } else {
          tr.append(`<td>${esc(dateText)}</td>`);
        }
        tbody.append(tr);
      });

      if ($.fn.dataTable.isDataTable('#glossaryTable')) {
        $('#glossaryTable').DataTable().destroy();
      }

      const table = $('#glossaryTable').DataTable({
        order: [[0, "asc"]],
        columnDefs: [{ targets: 2, type: "num" }],
        language: {
          search: "Cari:",
          lengthMenu: "Tampilkan _MENU_ entri",
          info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ entri",
          infoEmpty: "Tidak ada data tersedia",
          zeroRecords: "Tidak ditemukan data yang cocok",
          paginate: { first:"Awal", last:"Akhir", next:"Berikutnya", previous:"Sebelumnya" }
        },
        pageLength: 25
      });

      $('#searchInput').on('keyup', function(){
        table.search(this.value).draw();
      });
    },
    error: function(err){
      console.error("PapaParse error:", err);
      alert("Gagal memuat data dari Google Sheets. Pastikan link CSV publik benar dan dapat diakses.");
    }
  });

})();
</script>
</body>
</html>
